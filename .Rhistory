NDVIdir <- 'X:/Imagery/Granadilla/Skybox/spectral_indices'
NDVI_files <- list.files(NDVIdir)
NDVI_files <- NDVI_files[substr(NDVI_files,nchar(NDVI_files)-3,nchar(NDVI_files)) == '.tif']
NDVI_files <- file.path(NDVIdir, NDVI_files)
outp <- NULL
for (i in 1:length(example_extents)){
surf_ext <- example_extents[[i]]
imdates <- NULL
NDVI_mn <- NULL
NDVI_sd <- NULL
for (NDVI_file in NDVI_files){
r <- raster::raster(NDVI_file)
# if the raster and the extent overlap
if (!is.null(raster::intersect(raster::extent(r), surf_ext))){
NDVI_mn <- c(NDVI_mn, raster::extract(x = r, y = surf_ext, fun = mean))
NDVI_sd <- c(NDVI_sd, raster::extract(x = r, y = surf_ext, fun = sd))
imdates <- rbind(imdates,get_TerraBella_scene_date(tifname = NDVI_file))
}
}
outp1 <- cbind.data.frame(imdates, NDVI_mn, NDVI_sd, surf = names(example_extents)[i] )
if (is.null(outp)){
outp <- outp1
}else{
outp <- rbind.data.frame(outp, outp)
}
}
road_ext <- raster::extent(c())
bare_soil_ext <- raster::extent(c(747720, 747730,4463970,4463980))
forest_ext <- raster::extent(c(748150, 748300, 4463800,4463900))
water_ext <-  raster::extent(c(746400,746700,4463100,4463200))
example_extents <- list(bare_soil = bare_soil_ext, water = water_ext, forest = forest_ext)
NDVIdir <- 'X:/Imagery/Granadilla/Skybox/spectral_indices'
NDVI_files <- list.files(NDVIdir)
NDVI_files <- NDVI_files[substr(NDVI_files,nchar(NDVI_files)-3,nchar(NDVI_files)) == '.tif']
NDVI_files <- file.path(NDVIdir, NDVI_files)
outp <- NULL
for (i in 1:length(example_extents)){
surf_ext <- example_extents[[i]]
imdates <- NULL
NDVI_mn <- NULL
NDVI_sd <- NULL
for (NDVI_file in NDVI_files){
r <- raster::raster(NDVI_file)
# if the raster and the extent overlap
if (!is.null(raster::intersect(raster::extent(r), surf_ext))){
NDVI_mn <- c(NDVI_mn, raster::extract(x = r, y = surf_ext, fun = mean))
NDVI_sd <- c(NDVI_sd, raster::extract(x = r, y = surf_ext, fun = sd))
imdates <- rbind(imdates,get_TerraBella_scene_date(tifname = NDVI_file))
}
}
outp1 <- cbind.data.frame(imdates, NDVI_mn, NDVI_sd, surf = names(example_extents)[i] )
if (is.null(outp)){
outp <- outp1
}else{
outp <- rbind.data.frame(outp, outp)
}
}
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surf)) + geom_line() + geom_point()
outp <- NULL
for (i in 1:length(example_extents)){
surf_ext <- example_extents[[i]]
imdates <- NULL
NDVI_mn <- NULL
NDVI_sd <- NULL
for (NDVI_file in NDVI_files){
r <- raster::raster(NDVI_file)
# if the raster and the extent overlap
if (!is.null(raster::intersect(raster::extent(r), surf_ext))){
NDVI_mn <- c(NDVI_mn, raster::extract(x = r, y = surf_ext, fun = mean))
NDVI_sd <- c(NDVI_sd, raster::extract(x = r, y = surf_ext, fun = sd))
imdates <- rbind(imdates,get_TerraBella_scene_date(tifname = NDVI_file))
}
}
outp1 <- cbind.data.frame(imdates, NDVI_mn, NDVI_sd, surf = names(example_extents)[i] )
if (is.null(outp)){
outp <- outp1
}else{
outp <- rbind.data.frame(outp, outp1)
}
}
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surf)) + geom_line() + geom_point()
head(outp)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surf)) + geom_line() + geom_point(sensornr)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surf, shape = sensornr)) + geom_line() + geom_point()
table(outp$sensornr)
54000/12
93000/12
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn _ NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
names(outp)
names(outp) <- c('sensornr','rawdate','NDVI_mn', 'NDVI_sd','surface')
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr), ylab = 'NDVI') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr,  ylab = 'NDVI', xlab='')) +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
bare_soil_ext <- raster::extent(c(747720, 747730,4463970,4463980))
forest_ext <- raster::extent(c(748150, 748300, 4463800,4463900))
water_ext <-  raster::extent(c(746400,746700,4463100,4463200))
example_extents <- list(bare_soil = bare_soil_ext, water = water_ext, forest = forest_ext)
NDVIdir <- 'X:/Imagery/Granadilla/Skybox/spectral_indices'
NDVI_files <- list.files(NDVIdir)
NDVI_files <- NDVI_files[substr(NDVI_files,nchar(NDVI_files)-3,nchar(NDVI_files)) == '.tif']
NDVI_files <- file.path(NDVIdir, NDVI_files)
outp <- NULL
for (i in 1:length(example_extents)){
surf_ext <- example_extents[[i]]
imdates <- NULL
NDVI_mn <- NULL
NDVI_sd <- NULL
for (NDVI_file in NDVI_files){
r <- raster::raster(NDVI_file)
# if the raster and the extent overlap
if (!is.null(raster::intersect(raster::extent(r), surf_ext))){
NDVI_mn <- c(NDVI_mn, raster::extract(x = r, y = surf_ext, fun = mean))
NDVI_sd <- c(NDVI_sd, raster::extract(x = r, y = surf_ext, fun = sd))
imdates <- rbind(imdates,get_TerraBella_scene_date(tifname = NDVI_file))
}
}
outp1 <- cbind.data.frame(imdates, NDVI_mn, NDVI_sd, surface = names(example_extents)[i] )
if (is.null(outp)){
outp <- outp1
}else{
outp <- rbind.data.frame(outp, outp1)
}
}
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
}
?sort
sort(outp$rawdate)
outp <- outp[sort(outp$rawdate),]
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
head(outp)
outp$rawdate)
outp$rawdate
imdates
imdates$rawdate
order(imdates$rawdate)
road_ext <- raster::extent(c())
bare_soil_ext <- raster::extent(c(747720, 747730,4463970,4463980))
forest_ext <- raster::extent(c(748150, 748300, 4463800,4463900))
water_ext <-  raster::extent(c(746400,746700,4463100,4463200))
example_extents <- list(bare_soil = bare_soil_ext, water = water_ext, forest = forest_ext)
NDVIdir <- 'X:/Imagery/Granadilla/Skybox/spectral_indices'
NDVI_files <- list.files(NDVIdir)
NDVI_files <- NDVI_files[substr(NDVI_files,nchar(NDVI_files)-3,nchar(NDVI_files)) == '.tif']
NDVI_files <- file.path(NDVIdir, NDVI_files)
outp <- NULL
for (i in 1:length(example_extents)){
surf_ext <- example_extents[[i]]
imdates <- NULL
NDVI_mn <- NULL
NDVI_sd <- NULL
for (NDVI_file in NDVI_files){
r <- raster::raster(NDVI_file)
# if the raster and the extent overlap
if (!is.null(raster::intersect(raster::extent(r), surf_ext))){
NDVI_mn <- c(NDVI_mn, raster::extract(x = r, y = surf_ext, fun = mean))
NDVI_sd <- c(NDVI_sd, raster::extract(x = r, y = surf_ext, fun = sd))
imdates <- rbind(imdates,get_TerraBella_scene_date(tifname = NDVI_file))
}
}
outp1 <- cbind.data.frame(imdates, NDVI_mn, NDVI_sd, surface = names(example_extents)[i] )
if (is.null(outp)){
outp <- outp1
}else{
outp <- rbind.data.frame(outp, outp1)
}
}
outp <- outp[order(outp$rawdate), ]
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
}
outp
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
}
outp <- complete.cases(outp),]
outp <- outp[complete.cases(outp),]
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
plot(outp$rawdate)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
#geom_line() +
geom_point() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
outp$rawdate[outp$surface =='forest']
outp$NDVI_mn[outp$surface =='forest']
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_path() +
geom_line() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_point() +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_point() +
#geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_point() +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
geom_point() +
geom_path(aes(x = rawdate, y = NDVI_mn,colour = surface, shape = sensornr)) +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path(aes(x = rawdate, y = NDVI_mn,colour = surface, shape = sensornr)) +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path(outp,aes(x = rawdate, y = NDVI_mn,colour = surface, shape = sensornr)) +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path(aes(x = rawdate, y = NDVI_mn,colour = surface, shape = sensornr)) +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) +
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path(aes(x = rawdate, y = NDVI_mn,colour = surface, shape = sensornr), data = outp) +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) + geom_path(
)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) + geom_path()
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) + geom_line()
outp$rawdate
plot(outp$rawdate,outp$NDVI_mn)
plot(outp$rawdate,outp$NDVI_mn,type='l')
?order
?order
outp <- outp[order(outp$surface, outp$rawdate), ]
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) + geom_line()
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path(aes(x = rawdate, y = NDVI_mn,colour = surface, shape = sensornr), data = outp) +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) + geom_line()
outp
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape = sensornr)) + geom_path()
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn)) + geom_path()
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) + geom_path()
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface))
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface))
ylab('NDVI') +
xlab('') +
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
# geom_point() +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point( type =sensornr) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
head(outp)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point( shape = sensornr) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point(outp,aes(x = rawdate, y = NDVI_mn, shape = sensornr)) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
#geom_point(outp,aes(x = rawdate, y = NDVI_mn, shape = sensornr)) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface, shape=sensornr)) +
ylab('NDVI') +
xlab('') +
#geom_point(outp,aes(x = rawdate, y = NDVI_mn, shape = sensornr)) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point(outp,aes(x = rawdate, y = NDVI_mn, shape = sensornr)) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point(shape = sensornr)) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point(shape = sensornr) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
ggplot2::ggplot(outp, aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point(aes(shape = sensornr)) +
geom_path() +
geom_errorbar(aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
?CanHeMonR::create_overview_of_rasters
TerraBella_dir <- 'X:/Imagery/Granadilla/Skybox'
CanHeMonR::create_overview_of_rasters(TerraBella_dir)
ims_extent <- raster::shapefile(file.path(TerraBella_dir, 'images_overview.shp'))
plot(ims_exent, axes=T)
plot(ims_extent, axes=T)
raster::plot(ims_extent, axes=T)
so::plot(ims_extent, axes=T)
sp::plot(ims_extent, axes=T)
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes')
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',fill='grey')
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col='grey')
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.5))
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.2))
?sp::plot
?plot
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.2),line.col=0)
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.2),border=0)
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.2),border=NULL)
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.2),border="transparent")
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.1),border="transparent")
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.08),border="transparent")
sp::plot(ims_extent, axes=T, main = 'outline of TerraBella scenes',col=rgb (0.5,0.5,0.5,0.1),border="transparent")
sp::plot(ims_extent, axes=T, main = 'density of TerraBella coverage',col=rgb (0.5,0.5,0.5,0.1),border="transparent")
projection(r)
raster::projection(r)
raster::projection(ims_extent)
sp::plot(ims_extent, axes=T, main = 'density of TerraBella coverage',col=rgb (0.5,0.5,0.5,0.1),border="transparent",
sub = raster::projection(ims_extent))
TerraBella_dir <- 'X:/Imagery/Granadilla/Skybox'
CanHeMonR::create_overview_of_rasters(TerraBella_dir)
?aes
dim(outp)
head(outp)
dim(outp$sensornr)
table(outp$sensornr)
calculate_TerraBella_indices  <- function(inp_tif_fnames, index_names, outp_dir, overwrite = T){
#the TerraBella band wavelengths in nm, taken from the specs page. The fifth band is PAN
TerBel_wavelengths <- cbind(c(450.0, 515.0),c(515.0, 595.0),c(605.0, 695.0),c(740.0, 900.0),c(NA,NA))
TerBel_wavelengths <- format((apply(TerBel_wavelengths,2,mean)),digits=6)
TerBel_wavelengths_names <- paste0('X',TerBel_wavelengths,'.Nanometers')
for (inp_tif_fname in inp_tif_fnames){
#read in the input filename
r <- raster::brick(inp_tif_fname)
#assign the wavelengths as layernames following Quantalab convention (e.g. X450.000000.Nanometers)
names(r) <- TerBel_wavelengths_names
as.numeric(unlist(lapply((strsplit(names(r),split="[X.]")),function(x){x[2]})))
#calculate the requested index
for (index_name in index_names){
#create the filename of the output
index_fname <- gsub('.tif',paste0('_NDVI','.tif'),basename(inp_tif_fname))
index_fname <- file.path(outp_dir,index_fname)
if (!(file.exists(index_fname)) | ((file.exists(index_fname)) & (overwrite == T))){
#calculate the index
#first retrieve the function for this index (code source: http://r.789695.n4.nabble.com/alternatives-to-do-call-when-namespace-is-attached-but-not-loaded-td4703774.html)
funct <- getExportedValue("CanHeMonR", index_name)
#now execute
raster::rasterOptions(progress = 'text')
do.call(funct, args = list(df=r, outp_fname = index_fname))
}
}
}
return()
}
inpdir <- 'X:/Imagery/Granadilla/Skybox'
fnames <- list.files(inpdir)
fnames <- fnames[grep('.tif',fnames)]
fnames <- fnames[substr(fnames,nchar(fnames)-3,nchar(fnames))==".tif"]
fnames <- file.path(inpdir, fnames)
raster::rasterOptions(progress='text')
calculate_TerraBella_indices(inp_tif_fnames = fnames, index_names='NDVI',overwrite = F,
outp_dir ="X:/Imagery/Granadilla/Skybox/spectral_indices")
raster::rasterOptions(tmpdir = 'E:/beckpie/temp/Raster_temp')
inpdir <- 'X:/Imagery/Granadilla/Skybox'
fnames <- list.files(inpdir)
fnames <- fnames[grep('.tif',fnames)]
fnames <- fnames[substr(fnames,nchar(fnames)-3,nchar(fnames))==".tif"]
fnames <- file.path(inpdir, fnames)
raster::rasterOptions(progress='text')
calculate_TerraBella_indices(inp_tif_fnames = fnames, index_names='NDVI',overwrite = F,
outp_dir ="X:/Imagery/Granadilla/Skybox/spectral_indices")
bare_soil_ext <- raster::extent(c(747720, 747730,4463970,4463980))
forest_ext <- raster::extent(c(748150, 748300, 4463800,4463900))
water_ext <-  raster::extent(c(746400,746700,4463100,4463200))
example_extents <- list(bare_soil = bare_soil_ext, water = water_ext, forest = forest_ext)
NDVIdir <- 'X:/Imagery/Granadilla/Skybox/spectral_indices'
NDVI_files <- list.files(NDVIdir)
NDVI_files <- NDVI_files[substr(NDVI_files,nchar(NDVI_files)-3,nchar(NDVI_files)) == '.tif']
NDVI_files <- file.path(NDVIdir, NDVI_files)
outp <- NULL
for (i in 1:length(example_extents)){
surf_ext <- example_extents[[i]]
imdates <- NULL
NDVI_mn <- NULL
NDVI_sd <- NULL
for (NDVI_file in NDVI_files){
r <- raster::raster(NDVI_file)
# if the raster and the extent overlap
if (!is.null(raster::intersect(raster::extent(r), surf_ext))){
NDVI_mn <- c(NDVI_mn, raster::extract(x = r, y = surf_ext, fun = mean))
NDVI_sd <- c(NDVI_sd, raster::extract(x = r, y = surf_ext, fun = sd))
imdates <- rbind(imdates,CanHeMonR::get_TerraBella_scene_date(tifname = NDVI_file))
}
}
outp1 <- cbind.data.frame(imdates, NDVI_mn, NDVI_sd, surface = names(example_extents)[i] )
if (is.null(outp)){
outp <- outp1
}else{
outp <- rbind.data.frame(outp, outp1)
}
}
outp <- outp[complete.cases(outp),]
outp <- outp[order(outp$surface, outp$rawdate), ]
require(ggplot2)
ggplot(outp, ggplot2::aes(x = rawdate, y = NDVI_mn, colour = surface)) +
ylab('NDVI') +
xlab('') +
geom_point(aes(shape = sensornr)) +
geom_path() +
geom_errorbar(ggplot2::aes(ymin = NDVI_mn - NDVI_sd, ymax = NDVI_mn + NDVI_sd), width = .2)
print(summary(outp))
library(CanHeMonR)
devtools::document()
library(CanHeMonR)
